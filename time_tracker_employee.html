<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Time Tracker v1.1.2</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234facfe'><circle cx='12' cy='12' r='10' stroke='%23667eea' stroke-width='2' fill='%234facfe'/><path d='M12 6v6l4 2' stroke='white' stroke-width='2' stroke-linecap='round'/></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            color: white;
        }

        .logo-section {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #ffffff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo-tagline {
            font-size: 0.9rem;
            opacity: 0.8;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .header-controls {
            display: grid;
            grid-template-columns: 1fr 120px 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
            opacity: 0.9;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            background: rgba(255,255,255,0.9);
        }

        /* Pay Period Info Bar */
        .pay-period-info {
            background: rgba(255,255,255,0.1);
            padding: 15px 30px;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.2);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: center;
        }

        .pay-period-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .pay-period-detail .label {
            font-weight: 500;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .pay-period-detail .value {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .main-content {
            padding: 30px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .timer-section {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 16px;
            color: white;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 300;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }

        .timer-button {
            padding: 16px 48px;
            font-size: 1.2rem;
            border: none;
            border-radius: 50px;
            background: white;
            color: #333;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            min-height: 60px;
            min-width: 120px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .timer-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .timer-button.stop {
            background: #ff4757;
            color: white;
        }

        .daily-counter {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .daily-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .daily-progress {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .progress-bar-small {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill-small {
            height: 100%;
            background: rgba(255,255,255,0.8);
            border-radius: 3px;
            transition: all 0.3s ease;
            width: 0%;
        }

        .progress-fill-small.approaching {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .progress-fill-small.exceeded {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }

        .category-selector {
            margin-top: 15px;
        }

        .category-selector select {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            font-size: 16px;
        }

        .stats-section {
            padding: 25px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 16px;
            color: #333;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 18px;
            background: rgba(255,255,255,0.7);
            border-radius: 12px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .entries-section {
            margin-top: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .entries-list {
            background: #f8f9fa;
            border-radius: 12px;
            overflow: hidden;
        }

        .entry-item {
            display: grid;
            grid-template-columns: 100px 120px 150px 1fr 80px 120px;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
        }

        .entry-item:last-child {
            border-bottom: none;
        }

        .entry-header {
            background: #3498db;
            color: white;
            font-weight: 600;
        }

        .entry-date {
            font-weight: 600;
            color: #2c3e50;
        }

        .entry-category {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
        }

        .category-work { background: #e3f2fd; color: #1565c0; }
        .category-overhead { background: #f3e5f5; color: #6a1b9a; }
        .category-travel { background: #e8f5e8; color: #388e3c; }
        .category-pto { background: #fff3e0; color: #ef6c00; }
        .category-sick { background: #ffebee; color: #c62828; }
        .category-holiday { background: #e8f5e8; color: #2e7d32; }
        .category-bereavement { background: #f3e5f5; color: #7b1fa2; }
        .category-jury { background: #e0f2f1; color: #00695c; }

        .edit-input {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
        }

        .action-button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .edit-btn {
            background: #17a2b8;
            color: white;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
        }

        .warning {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4757;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .no-entries {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px 30px;
            border-top: 1px solid #e9ecef;
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .footer .credits {
            margin: 0;
            font-weight: 500;
        }

        .recovery-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .recovery-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 500px;
            text-align: center;
        }

        .recovery-content h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .recovery-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #17a2b8;
        }

        .recovery-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .recovery-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-adjust {
            background: #17a2b8;
            color: white;
        }

        .btn-discard {
            background: #dc3545;
            color: white;
        }

        .recovery-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .adjust-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .adjust-section.show {
            display: block;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
        }

        .time-inputs input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .export-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 500px;
            text-align: center;
        }

        .export-content h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .export-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .export-option {
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .export-option:hover {
            border-color: #3498db;
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .export-option-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .export-option-desc {
            font-size: 0.9rem;
            color: #6c757d;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 12px;
            }
            
            .header {
                padding: 20px;
            }
            
            .logo-text {
                font-size: 1.4rem;
                letter-spacing: 1px;
            }
            
            .logo-tagline {
                font-size: 0.8rem;
            }
            
            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 15px;
            }
            
            .header-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .pay-period-info {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 15px 20px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .timer-section {
                padding: 25px 20px;
            }
            
            .timer-display {
                font-size: 2.5rem;
                margin-bottom: 15px;
            }
            
            .daily-counter {
                margin: 15px 0;
                padding: 12px;
            }
            
            .daily-progress {
                font-size: 1.1rem;
            }
            
            .timer-button {
                padding: 18px 40px;
                font-size: 1.3rem;
                margin-bottom: 15px;
                min-height: 60px;
                border-radius: 30px;
            }
            
            .category-selector select {
                padding: 12px;
                font-size: 18px;
                min-height: 50px;
                border-radius: 12px;
            }
            
            .project-selector input {
                padding: 12px;
                font-size: 18px;
                min-height: 50px;
                border-radius: 12px;
                margin-top: 10px;
            }
            
            .stats-section {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            
            .stat-item {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .section-title {
                font-size: 1.3rem;
            }
            
            .entry-item {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 15px;
                text-align: left;
            }
            
            .entry-header {
                display: none;
            }
            
            .entry-date {
                font-size: 1.1rem;
                margin-bottom: 5px;
                border-bottom: 1px solid #eee;
                padding-bottom: 5px;
            }
            
            .entry-category {
                margin: 5px 0;
                display: inline-block;
            }
            
            .mobile-entry-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin: 10px 0;
                align-items: center;
            }
            
            .mobile-entry-actions {
                display: flex;
                gap: 8px;
                margin-top: 10px;
            }
            
            .action-button {
                flex: 1;
                padding: 10px;
                font-size: 14px;
                min-height: 44px;
                border-radius: 8px;
            }
            
            .edit-input {
                padding: 12px;
                font-size: 16px;
                min-height: 44px;
                border-radius: 8px;
            }
            
            .recovery-modal {
                padding: 15px;
            }
            
            .recovery-content {
                padding: 25px 20px;
                margin: 0;
                max-width: 95vw;
                border-radius: 12px;
            }
            
            .recovery-content h3 {
                font-size: 1.3rem;
                margin-bottom: 15px;
            }
            
            .recovery-buttons {
                flex-direction: column;
                gap: 12px;
            }
            
            .recovery-btn {
                padding: 15px 20px;
                font-size: 16px;
                min-height: 50px;
                border-radius: 12px;
            }
            
            .time-inputs {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .time-inputs input {
                padding: 12px;
                font-size: 16px;
                min-height: 44px;
                border-radius: 8px;
            }
            
            .time-inputs label {
                font-weight: 600;
                margin-bottom: 5px;
                display: block;
            }
            
            .warning {
                right: 10px;
                left: 10px;
                top: 10px;
                text-align: center;
                border-radius: 12px;
                padding: 15px;
                font-size: 16px;
            }
            
            .footer {
                padding: 15px 20px;
                font-size: 0.85rem;
            }
            
            .form-group input, .form-group select {
                min-height: 44px;
                font-size: 16px;
                border-radius: 8px;
            }
            
            .export-button {
                padding: 15px 20px;
                font-size: 16px;
                border-radius: 12px;
                min-height: 50px;
            }
            
            .import-button {
                padding: 15px 20px;
                font-size: 16px;
                border-radius: 12px;
                min-height: 50px;
            }

            .clear-button {
                padding: 15px 20px;
                font-size: 16px;
                border-radius: 12px;
                min-height: 50px;
            }
            
            .buttons-container {
                flex-direction: column;
                width: 100%;
                gap: 12px;
            }
            
            .import-button, .export-button {
                width: 100%;
                margin-left: 0;
            }

            .clear-button {
                width: 100%;
                margin-left: 0;
            }
        }

        /* Additional styles for proper table display */
        .entries-table-header {
            display: flex;
            background: #3498db;
            color: white;
            font-weight: 600;
            padding: 12px 15px;
            border-radius: 12px 12px 0 0;
            margin-bottom: 0;
        }

        .header-cell {
            flex: 1;
            padding: 0 10px;
            text-align: left;
        }

        .view-controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .view-button {
            padding: 8px 15px;
            border: 1px solid #ced4da;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .view-button.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .export-section {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .export-button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            background: #28a745;
            color: white;
        }

        .export-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div>
                    <div class="logo-text">NAKUPUNA</div>
                    <div class="logo-tagline">CONSULTING</div>
                </div>
            </div>
            <h1>🕐 Employee Time Tracker v1.1.2</h1>
            <div class="header-controls">
                <div class="form-group">
                    <label>Employee Name:</label>
                    <input type="text" id="employeeName" placeholder="Enter your name">
                </div>
                <div class="form-group">
                    <label>Daily Target Hours:</label>
                    <input type="number" id="dailyTarget" value="8" min="1" max="24" step="0.5" onchange="updateDisplay()">
                </div>
                <div class="form-group">
                    <label>Pay Period:</label>
                    <select id="payPeriodSelect" onchange="setSelectedPayPeriod()">
                        <option value="">Select Pay Period</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Period End:</label>
                    <input type="date" id="periodEnd" onchange="updateDisplay()">
                </div>
            </div>
        </div>

        <!-- Pay Period Info Bar -->
        <div class="pay-period-info" id="payPeriodInfo" style="display: none;">
            <div class="pay-period-detail">
                <span class="label">Period:</span>
                <span class="value" id="periodRange">-</span>
            </div>
            <div class="pay-period-detail">
                <span class="label">Timesheet Due:</span>
                <span class="value" id="timesheetDue">-</span>
            </div>
            <div class="pay-period-detail">
                <span class="label">Pay Day:</span>
                <span class="value" id="payDay">-</span>
            </div>
            <div class="pay-period-detail">
                <span class="label">Days Remaining:</span>
                <span class="value" id="daysRemaining">-</span>
            </div>
        </div>

        <div class="main-content">
            <div class="dashboard">
                <div class="timer-section">
                    <div class="timer-display" id="timerDisplay">00:00:00</div>
                    <button class="timer-button" id="timerButton" onclick="toggleTimer()">Start</button>
                    <div class="daily-counter">
                        <div class="daily-label">Today's Progress</div>
                        <div class="daily-progress" id="dailyCounter">0.0 / 8.0h</div>
                        <div class="progress-bar-small">
                            <div class="progress-fill-small" id="progressFillSmall"></div>
                        </div>
                    </div>
                    <div class="category-selector">
                        <label style="color: rgba(255,255,255,0.9); margin-right: 10px;">Category:</label>
                        <select id="categorySelect">
                            <option value="work">Work</option>
                            <option value="overhead">Overhead</option>
                            <option value="travel">Paid Travel</option>
                            <option value="pto">PTO</option>
                            <option value="sick">Sick Day</option>
                            <option value="holiday">Holiday</option>
                            <option value="bereavement">Bereavement</option>
                            <option value="jury">Jury Duty</option>
                        </select>
                    </div>
                    <div class="project-selector">
                        <label style="color: rgba(255,255,255,0.9); margin-right: 10px;">Project:</label>
                        <input type="text" id="projectInput" placeholder="Enter project name" style="padding: 10px; border: none; border-radius: 8px; background: rgba(255,255,255,0.9); font-size: 16px; margin-top: 10px; width: 100%;">
                    </div>
                </div>

                <div class="stats-section">
                    <h3 style="margin-bottom: 18px; text-align: center;">Period Summary</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalHours">0.0</div>
                            <div class="stat-label">Period Hours</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="periodDays">0</div>
                            <div class="stat-label">Total Period Days</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="workDays">0</div>
                            <div class="stat-label">Days Worked</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="daysElapsed">0</div>
                            <div class="stat-label">Days Elapsed</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="entries-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin-bottom: 0;">Time Entries</h2>
                    <div class="export-section">
                        <button class="export-button" onclick="exportToCSV()">📥 Export CSV</button>
                        <button class="export-button" onclick="importCSV()" style="background: #3498db;">📤 Import CSV</button>
                        <button class="export-button" onclick="clearAllData()" style="background: #e74c3c;">🗑️ Clear All</button>
                    </div>
                </div>
                
                <div class="view-controls">
                    <button class="view-button active" onclick="setView('detailed')">Detailed View</button>
                    <button class="view-button" onclick="setView('daily')">Daily Summary</button>
                </div>

                <div class="entries-list" id="entriesList">
                    <div class="no-entries">No time entries found for this period</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p class="credits">Employee Time Tracker v1.1.2 | Philippe Addelia | NAKUPUNA CONSULTING</p>
        </div>
    </div>

    <script>
        // Company Configuration - EDIT THIS SECTION TO CUSTOMIZE FOR YOUR COMPANY
        const COMPANY_CONFIG = {
            "companyName": "NAKUPUNA CONSULTING",
            "companyLogoPath": "Company_logo.png",
            "companyTagline": "Time Management Solutions",
            "showTagline": false,
            "logoMaxHeight": "60px",
            "logoMaxWidth": "200px"
        };

        // Built-in pay periods configuration
        const DEFAULT_PAY_PERIODS_CONFIG = {
            "version": "1.1.2",
            "lastUpdated": "2025-08-17T12:00:00-08:00",
            "company": {
                "name": COMPANY_CONFIG.companyName || "NAKUPUNA CONSULTING",
                "payrollCycle": "bi-weekly",
                "timeZone": "PST"
            },
            "payPeriods": [
                {
                    "id": "PP-2025-16",
                    "startDate": "2025-08-02",
                    "endDate": "2025-08-15",
                    "timesheetDue": "2025-08-15",
                    "payDay": "2025-08-22",
                    "description": "Pay Period 16 - August 2nd to 15th"
                },
                {
                    "id": "PP-2025-17",
                    "startDate": "2025-08-16",
                    "endDate": "2025-08-29",
                    "timesheetDue": "2025-08-29",
                    "payDay": "2025-09-05",
                    "description": "Pay Period 17 - August 16th to 29th"
                },
                {
                    "id": "PP-2025-18",
                    "startDate": "2025-08-30",
                    "endDate": "2025-09-12",
                    "timesheetDue": "2025-09-12",
                    "payDay": "2025-09-19",
                    "description": "Pay Period 18 - August 30th to September 12th"
                },
                {
                    "id": "PP-2025-19",
                    "startDate": "2025-09-13",
                    "endDate": "2025-09-26",
                    "timesheetDue": "2025-09-26",
                    "payDay": "2025-10-03",
                    "description": "Pay Period 19 - September 13th to 26th"
                }
            ],
            "holidays": [
                {
                    "date": "2025-01-01",
                    "name": "New Year's Day",
                    "type": "federal"
                },
                {
                    "date": "2025-01-20",
                    "name": "Martin Luther King Jr. Day",
                    "type": "federal"
                },
                {
                    "date": "2025-02-17",
                    "name": "Presidents Day",
                    "type": "federal"
                },
                {
                    "date": "2025-05-26",
                    "name": "Memorial Day",
                    "type": "federal"
                },
                {
                    "date": "2025-06-19",
                    "name": "Juneteenth",
                    "type": "federal"
                },
                {
                    "date": "2025-07-04",
                    "name": "Independence Day",
                    "type": "federal"
                },
                {
                    "date": "2025-09-01",
                    "name": "Labor Day",
                    "type": "federal"
                },
                {
                    "date": "2025-10-13",
                    "name": "Columbus Day",
                    "type": "federal"
                },
                {
                    "date": "2025-11-11",
                    "name": "Veteran's Day",
                    "type": "federal"
                },
                {
                    "date": "2025-11-27",
                    "name": "Thanksgiving Day",
                    "type": "federal"
                },
                {
                    "date": "2025-12-25",
                    "name": "Christmas Day",
                    "type": "federal"
                }
            ],
            "configVersion": "1.1.2",
            "lastUpdated": "2025-08-17",
            "company": COMPANY_CONFIG.companyName || "NAKUPUNA CONSULTING"
        };

        // Global state
        let isTracking = false;
        let startTime = null;
        let timerInterval = null;
        let timeEntries = [];
        let warningShown = false;
        let autoSaveInterval = null;
        let currentView = 'detailed';
        let selectedImportMode = 'append';
        let payPeriodsConfig = null;
        let selectedPayPeriod = null;
        let companyHolidays = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadPayPeriodsConfig();
            setupEventListeners();
            setupBeforeUnload();
            checkForIncompleteSession();
        });

        // Pay periods and holidays configuration
        function loadPayPeriodsConfig() {
            try {
                const savedConfig = localStorage.getItem('payPeriodsConfig');
                if (savedConfig) {
                    payPeriodsConfig = JSON.parse(savedConfig);
                    console.log('Loaded pay periods config from localStorage');
                } else {
                    payPeriodsConfig = DEFAULT_PAY_PERIODS_CONFIG;
                    console.log('Using default pay periods config');
                }
                
                companyHolidays = payPeriodsConfig.holidays || [];
                populatePayPeriods();
                setDefaultPeriod();
                
            } catch (error) {
                console.error('Error loading pay periods config:', error);
                payPeriodsConfig = DEFAULT_PAY_PERIODS_CONFIG;
                companyHolidays = payPeriodsConfig.holidays || [];
                populatePayPeriods();
                setDefaultPeriod();
            }
        }

        function populatePayPeriods() {
            const select = document.getElementById('payPeriodSelect');
            select.innerHTML = '<option value="">Select Pay Period</option>';
            
            if (payPeriodsConfig && payPeriodsConfig.payPeriods) {
                payPeriodsConfig.payPeriods.forEach(period => {
                    const option = document.createElement('option');
                    option.value = period.id;
                    option.textContent = period.description;
                    select.appendChild(option);
                });
            }
        }

        function setSelectedPayPeriod() {
            const selectedId = document.getElementById('payPeriodSelect').value;
            selectedPayPeriod = payPeriodsConfig.payPeriods.find(p => p.id === selectedId);
            
            if (selectedPayPeriod) {
                // Set period dates
                document.getElementById('periodEnd').value = selectedPayPeriod.endDate;
                
                // Show pay period info
                updatePayPeriodInfo();
                document.getElementById('payPeriodInfo').style.display = 'grid';
            } else {
                document.getElementById('payPeriodInfo').style.display = 'none';
            }
            
            updateDisplay();
        }

        function updatePayPeriodInfo() {
            if (!selectedPayPeriod) return;
            
            const today = new Date();
            const endDate = new Date(selectedPayPeriod.endDate);
            const daysRemaining = Math.max(0, Math.ceil((endDate - today) / (1000 * 60 * 60 * 24)));
            
            document.getElementById('periodRange').textContent = 
                `${selectedPayPeriod.startDate} to ${selectedPayPeriod.endDate}`;
            document.getElementById('timesheetDue').textContent = selectedPayPeriod.timesheetDue;
            document.getElementById('payDay').textContent = selectedPayPeriod.payDay;
            document.getElementById('daysRemaining').textContent = daysRemaining;
        }

        function setDefaultPeriod() {
            const today = new Date();
            const twoWeeksAgo = new Date(today);
            twoWeeksAgo.setDate(today.getDate() - 14);
            
            // Try to find current pay period
            if (payPeriodsConfig && payPeriodsConfig.payPeriods) {
                const currentPeriod = payPeriodsConfig.payPeriods.find(period => {
                    const start = new Date(period.startDate);
                    const end = new Date(period.endDate);
                    return today >= start && today <= end;
                });
                
                if (currentPeriod) {
                    document.getElementById('payPeriodSelect').value = currentPeriod.id;
                    setSelectedPayPeriod();
                    return;
                }
            }
            
            // Fallback to manual dates
            document.getElementById('periodEnd').value = formatDate(today);
        }

        function setupEventListeners() {
            document.getElementById('employeeName').addEventListener('input', saveData);
            document.getElementById('dailyTarget').addEventListener('input', saveData);
            document.getElementById('periodEnd').addEventListener('change', updateDisplay);
        }

        function setupBeforeUnload() {
            window.addEventListener('beforeunload', function(e) {
                if (isTracking) {
                    saveTrackingState();
                    e.returnValue = 'You have an active time tracking session. Are you sure you want to leave?';
                }
            });
        }

        function toggleTimer() {
            const timerButton = document.getElementById('timerButton');
            
            if (timerButton.disabled) return;
            timerButton.disabled = true;
            
            setTimeout(() => {
                timerButton.disabled = false;
            }, 500);
            
            if (isTracking) {
                stopTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            // Validation
            const employeeName = document.getElementById('employeeName').value;
            if (!employeeName.trim()) {
                alert('Please enter your employee name before starting the timer.');
                document.getElementById('employeeName').focus();
                return;
            }

            isTracking = true;
            startTime = new Date();
            warningShown = false;
            
            const timerButton = document.getElementById('timerButton');
            timerButton.textContent = 'Stop';
            timerButton.classList.add('stop');
            
            setTimeout(() => {
                timerButton.textContent = 'Stop';
                timerButton.classList.add('stop');
            }, 50);
            
            timerInterval = setInterval(updateTimer, 1000);
            saveTrackingState();
            autoSaveInterval = setInterval(saveTrackingState, 60000);
        }

        function stopTimer() {
            if (!isTracking) return;
            
            isTracking = false;
            const endTime = new Date();
            const category = document.getElementById('categorySelect').value;
            const project = document.getElementById('projectInput').value || 'No Project';
            
            const entry = {
                id: Date.now(),
                date: formatDate(startTime),
                category: category,
                project: project,
                startTime: formatTime(startTime),
                endTime: formatTime(endTime),
                duration: calculateDuration(startTime, endTime)
            };
            
            timeEntries = [...timeEntries, entry];
            
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            
            const timerButton = document.getElementById('timerButton');
            timerButton.textContent = 'Start';
            timerButton.classList.remove('stop');
            
            setTimeout(() => {
                timerButton.textContent = 'Start';
                timerButton.classList.remove('stop');
                timerButton.disabled = false;
            }, 50);
            
            document.getElementById('timerDisplay').textContent = '00:00:00';
            
            saveData();
            
            setTimeout(() => {
                updateDisplay();
                setTimeout(() => {
                    updateEntriesList();
                }, 100);
            }, 100);
            
            clearTrackingState();
            clearWarning();
        }

        function updateTimer() {
            if (!isTracking) return;
            
            const now = new Date();
            const elapsed = now - startTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            document.getElementById('timerDisplay').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            updateDailyCounter();
            
            const filteredEntries = getFilteredEntries();
            const todayEntries = filteredEntries.filter(entry => entry.date === formatDate(new Date()));
            const todayHours = todayEntries.reduce((sum, entry) => sum + entry.duration, 0);
            const dailyTarget = parseFloat(document.getElementById('dailyTarget').value) || 8;
            const currentSession = elapsed / 3600000;
            const projectedTotal = todayHours + currentSession;
            
            if (projectedTotal >= dailyTarget && !warningShown) {
                showDailyTargetWarning(projectedTotal, dailyTarget);
                warningShown = true;
            }
            
            if (now.getHours() >= 18 && !warningShown) {
                showWarning();
                warningShown = true;
            }
        }

        function calculateDuration(start, end) {
            const diff = end - start;
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            return parseFloat((hours + minutes / 60).toFixed(2));
        }

        function formatDate(date) {
            const dateObj = date instanceof Date ? date : new Date(date);
            const year = dateObj.getFullYear();
            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateObj.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatTime(date) {
            return date.toTimeString().split(' ')[0].substring(0, 5);
        }

        function formatDateTime(date) {
            return date.toLocaleDateString() + ' ' + formatTime(date);
        }

        function updateDisplay() {
            updateStats();
            updateDailyCounter();
            updateEntriesList();
            updatePayPeriodInfo();
        }

        function updateStats() {
            const filteredEntries = getFilteredEntries();
            const totalHours = filteredEntries.reduce((sum, entry) => sum + entry.duration, 0);
            const workDays = new Set(filteredEntries.map(entry => entry.date)).size;
            
            const periodEnd = document.getElementById('periodEnd').value;
            const today = formatDate(new Date());
            
            let periodDays = 0;
            let daysElapsed = 0;
            
            if (selectedPayPeriod) {
                const start = new Date(selectedPayPeriod.startDate);
                const end = new Date(selectedPayPeriod.endDate);
                periodDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                const currentDate = new Date(today);
                if (currentDate >= start && currentDate <= end) {
                    daysElapsed = Math.ceil((currentDate - start) / (1000 * 60 * 60 * 24)) + 1;
                } else if (currentDate > end) {
                    daysElapsed = periodDays;
                }
            } else if (periodEnd) {
                // Fallback calculation for manual period
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                const start = twoWeeksAgo;
                const end = new Date(periodEnd);
                periodDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                const currentDate = new Date(today);
                if (currentDate >= start && currentDate <= end) {
                    daysElapsed = Math.ceil((currentDate - start) / (1000 * 60 * 60 * 24)) + 1;
                } else if (currentDate > end) {
                    daysElapsed = periodDays;
                }
            }

            document.getElementById('totalHours').textContent = totalHours.toFixed(1);
            document.getElementById('periodDays').textContent = periodDays;
            document.getElementById('workDays').textContent = workDays;
            document.getElementById('daysElapsed').textContent = daysElapsed;
        }

        function updateDailyCounter() {
            const filteredEntries = getFilteredEntries();
            const todayEntries = filteredEntries.filter(entry => entry.date === formatDate(new Date()));
            const todayHours = todayEntries.reduce((sum, entry) => sum + entry.duration, 0);
            const dailyTarget = parseFloat(document.getElementById('dailyTarget').value) || 8;
            
            const dailyCounter = document.getElementById('dailyCounter');
            const progressFill = document.getElementById('progressFillSmall');
            
            let displayHours = todayHours;
            let progressPercent = (todayHours / dailyTarget) * 100;
            
            if (isTracking && startTime) {
                const currentSession = (new Date() - startTime) / 3600000;
                displayHours = todayHours + currentSession;
                progressPercent = (displayHours / dailyTarget) * 100;
                dailyCounter.textContent = `${todayHours.toFixed(1)} (+${currentSession.toFixed(1)}) / ${dailyTarget.toFixed(1)}h`;
            } else {
                dailyCounter.textContent = `${todayHours.toFixed(1)} / ${dailyTarget.toFixed(1)}h`;
            }
            
            progressFill.style.width = Math.min(progressPercent, 100) + '%';
            
            if (displayHours >= dailyTarget) {
                progressFill.className = 'progress-fill-small exceeded';
            } else if (displayHours >= dailyTarget * 0.9) {
                progressFill.className = 'progress-fill-small approaching';
            } else {
                progressFill.className = 'progress-fill-small';
            }
        }

        function getFilteredEntries() {
            if (selectedPayPeriod) {
                return timeEntries.filter(entry => {
                    return entry.date >= selectedPayPeriod.startDate && entry.date <= selectedPayPeriod.endDate;
                });
            } else {
                // Fallback to period end date
                const periodEnd = document.getElementById('periodEnd').value;
                if (!periodEnd) return timeEntries;
                
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                const startDate = formatDate(twoWeeksAgo);
                
                return timeEntries.filter(entry => {
                    return entry.date >= startDate && entry.date <= periodEnd;
                });
            }
        }

        function updateEntriesList() {
            const container = document.getElementById('entriesList');
            const filteredEntries = getFilteredEntries();
            
            if (filteredEntries.length === 0) {
                container.innerHTML = '<div class="no-entries">No time entries found for this period</div>';
                return;
            }
            
            if (currentView === 'detailed') {
                // Add table header for detailed view
                let tableHTML = `
                    <div class="entries-table-header">
                        <div class="header-cell">Date</div>
                        <div class="header-cell">Time Period</div>
                        <div class="header-cell">Duration</div>
                        <div class="header-cell">Category</div>
                        <div class="header-cell">Project</div>
                    </div>
                `;
                
                tableHTML += filteredEntries
                    .sort((a, b) => new Date(b.date + 'T' + b.startTime) - new Date(a.date + 'T' + a.startTime))
                    .map(entry => `
                        <div class="entry-item">
                            <div class="entry-date">${entry.date}</div>
                            <div class="entry-time">${entry.startTime} - ${entry.endTime}</div>
                            <div class="entry-duration">${entry.duration.toFixed(1)}h</div>
                            <div class="entry-category category-${entry.category}">${entry.category.toUpperCase()}</div>
                            <div class="entry-project">${entry.project || 'No Project'}</div>
                        </div>
                    `).join('');
                    
                container.innerHTML = tableHTML;
            } else {
                // Daily summary view - also as a table
                let tableHTML = `
                    <div class="entries-table-header">
                        <div class="header-cell">Date</div>
                        <div class="header-cell">Day of Week</div>
                        <div class="header-cell">Total Hours</div>
                        <div class="header-cell">Categories</div>
                    </div>
                `;
                
                const dailyTotals = {};
                filteredEntries.forEach(entry => {
                    if (!dailyTotals[entry.date]) {
                        dailyTotals[entry.date] = {
                            hours: 0,
                            categories: new Set()
                        };
                    }
                    dailyTotals[entry.date].hours += entry.duration;
                    dailyTotals[entry.date].categories.add(entry.category);
                });
                
                tableHTML += Object.entries(dailyTotals)
                    .sort(([a], [b]) => new Date(b) - new Date(a))
                    .map(([date, data]) => `
                        <div class="entry-item">
                            <div class="entry-date">${date}</div>
                            <div class="entry-day">${new Date(date).toLocaleDateString('en-US', { weekday: 'long' })}</div>
                            <div class="entry-duration">${data.hours.toFixed(1)}h</div>
                            <div class="entry-categories">
                                ${Array.from(data.categories).map(cat => 
                                    `<span class="entry-category category-${cat}">${cat.toUpperCase()}</span>`
                                ).join(' ')}
                            </div>
                        </div>
                    `).join('');
                    
                container.innerHTML = tableHTML;
            }
        }

        function setView(view) {
            currentView = view;
            
            document.querySelectorAll('.view-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            updateEntriesList();
        }

        // Export functionality
        function exportToCSV() {
            const employeeName = document.getElementById('employeeName').value || 'Employee';
            const filteredEntries = getFilteredEntries();
            
            if (filteredEntries.length === 0) {
                alert('No data to export for the selected period.');
                return;
            }
            
            const totalHours = filteredEntries.reduce((sum, entry) => sum + entry.duration, 0);
            const workDays = new Set(filteredEntries.map(entry => entry.date)).size;
            const avgDaily = workDays > 0 ? totalHours / workDays : 0;
            
            let csvContent = `Employee Name,Date,Category,Project,Start Time,End Time,Duration (Hours)\n`;
            
            filteredEntries
                .sort((a, b) => new Date(a.date + 'T' + a.startTime) - new Date(b.date + 'T' + b.startTime))
                .forEach(entry => {
                    csvContent += `"${employeeName}","${entry.date}","${entry.category}","${entry.project}","${entry.startTime}","${entry.endTime}",${entry.duration}\n`;
                });
            
            if (selectedPayPeriod) {
                csvContent += `\nSUMMARY\n`;
                csvContent += `Period,"${selectedPayPeriod.startDate} to ${selectedPayPeriod.endDate}"\n`;
                csvContent += `Total Hours,${totalHours.toFixed(1)}\n`;
                csvContent += `Work Days,${workDays}\n`;
                csvContent += `Average Daily Hours,${avgDaily.toFixed(2)}\n`;
                csvContent += `Export Date,"${new Date().toISOString().split('T')[0]}"\n`;
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            const fileName = selectedPayPeriod ? 
                `${employeeName.replace(/\s+/g, '_')}_${selectedPayPeriod.id}.csv` :
                `${employeeName.replace(/\s+/g, '_')}_Timesheet.csv`;
            link.href = url;
            link.download = fileName;
            link.click();
            
            window.URL.revokeObjectURL(url);
        }

        function importCSV() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        parseCSVImport(e.target.result);
                    } catch (error) {
                        alert('Error reading CSV file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function parseCSVImport(csvContent) {
            const lines = csvContent.split('\n').filter(line => line.trim());
            if (lines.length < 2) {
                alert('CSV file appears to be empty or invalid.');
                return;
            }
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, '').toLowerCase());
            let importedCount = 0;
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line || line.toLowerCase().includes('summary')) break;
                
                const values = line.split(',').map(v => v.trim().replace(/"/g, ''));
                if (values.length < headers.length) continue;
                
                try {
                    const entry = {
                        id: Date.now() + Math.random(),
                        date: values[1],
                        category: values[2] || 'work',
                        project: values[3] || 'No Project',
                        startTime: values[4],
                        endTime: values[5],
                        duration: parseFloat(values[6]) || 0
                    };
                    
                    if (entry.date && entry.startTime && entry.endTime && entry.duration > 0) {
                        timeEntries.push(entry);
                        importedCount++;
                    }
                } catch (error) {
                    console.warn('Skipped invalid line:', line);
                }
            }
            
            if (importedCount > 0) {
                saveData();
                updateDisplay();
                alert(`Successfully imported ${importedCount} time entries.`);
            } else {
                alert('No valid entries found in the CSV file.');
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL time tracking data? This cannot be undone.')) {
                timeEntries = [];
                saveData();
                updateDisplay();
                alert('All data has been cleared.');
            }
        }

        // Session recovery and tracking state functions
        function saveTrackingState() {
            try {
                if (!isTracking || !startTime) return;
                if (typeof(Storage) === "undefined" || !localStorage) return;
                
                const state = {
                    isTracking: true,
                    startTime: startTime.toISOString(),
                    category: document.getElementById('categorySelect').value,
                    project: document.getElementById('projectInput').value || 'No Project',
                    dailyTarget: document.getElementById('dailyTarget').value,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('timeTrackerState', JSON.stringify(state));
            } catch (error) {
                console.error('Error saving tracking state:', error);
            }
        }

        function clearTrackingState() {
            try {
                if (typeof(Storage) === "undefined" || !localStorage) return;
                localStorage.removeItem('timeTrackerState');
            } catch (error) {
                console.error('Error clearing tracking state:', error);
            }
        }

        function checkForIncompleteSession() {
            try {
                if (typeof(Storage) === "undefined" || !localStorage) return;
                const state = localStorage.getItem('timeTrackerState');
                if (state) {
                    const savedState = JSON.parse(state);
                    if (savedState && savedState.isTracking) {
                        showRecoveryModal(savedState);
                        return;
                    }
                }
            } catch (error) {
                console.error('Error checking incomplete session:', error);
            }
            
            // Set initial state
            const timerButton = document.getElementById('timerButton');
            timerButton.textContent = 'Start';
            timerButton.classList.remove('stop');
            timerButton.disabled = false;
            updateDisplay();
        }

        function showRecoveryModal(savedState) {
            const now = new Date();
            const savedStart = new Date(savedState.startTime);
            const elapsedHours = ((now - savedStart) / 3600000).toFixed(2);
            
            if (savedState.dailyTarget) {
                document.getElementById('dailyTarget').value = savedState.dailyTarget;
            }
            
            const modal = document.createElement('div');
            modal.className = 'recovery-modal';
            modal.innerHTML = `
                <div class="recovery-content">
                    <h3>🔄 Incomplete Time Session Detected</h3>
                    <div class="recovery-info">
                        <strong>Category:</strong> ${savedState.category.toUpperCase()}<br>
                        <strong>Project:</strong> ${savedState.project || 'No Project'}<br>
                        <strong>Started:</strong> ${formatDateTime(savedStart)}<br>
                        <strong>Calculated Duration:</strong> ${elapsedHours} hours<br>
                        <strong>Estimated End:</strong> ${formatDateTime(now)}
                    </div>
                    
                    <div class="adjust-section" id="adjustSection">
                        <h4>Adjust End Time:</h4>
                        <div class="time-inputs">
                            <label>End Date:</label>
                            <input type="date" id="adjustDate" value="${formatDate(now)}">
                            <label>End Time:</label>
                            <input type="time" id="adjustTime" value="${formatTime(now)}">
                        </div>
                        <div style="margin-top: 15px;">
                            <strong>Adjusted Duration: <span id="adjustedDuration">${elapsedHours}h</span></strong>
                        </div>
                    </div>
                    
                    <div class="recovery-buttons">
                        <button class="recovery-btn btn-save" onclick="recoverSession('save')">
                            💾 Save As-Is
                        </button>
                        <button class="recovery-btn btn-adjust" onclick="showAdjustSection()">
                            ⏰ Adjust Time
                        </button>
                        <button class="recovery-btn btn-discard" onclick="recoverSession('discard')">
                            🗑️ Discard
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Store state for recovery
            window.pendingRecoveryState = savedState;
        }

        function showAdjustSection() {
            document.getElementById('adjustSection').classList.add('show');
        }

        function recoverSession(action) {
            const savedState = window.pendingRecoveryState;
            const modal = document.querySelector('.recovery-modal');
            
            if (action === 'save') {
                saveRecoveredSession(savedState, new Date());
            } else if (action === 'adjust') {
                const adjustDate = document.getElementById('adjustDate').value;
                const adjustTime = document.getElementById('adjustTime').value;
                const adjustedEnd = new Date(`${adjustDate}T${adjustTime}`);
                saveRecoveredSession(savedState, adjustedEnd);
            }
            
            clearTrackingState();
            modal.remove();
            
            const timerButton = document.getElementById('timerButton');
            timerButton.textContent = 'Start';
            timerButton.classList.remove('stop');
            timerButton.disabled = false;
            
            updateDisplay();
        }

        function saveRecoveredSession(savedState, endTime) {
            const startTime = new Date(savedState.startTime);
            const entry = {
                id: Date.now(),
                date: formatDate(startTime),
                category: savedState.category,
                project: savedState.project || 'No Project',
                startTime: formatTime(startTime),
                endTime: formatTime(endTime),
                duration: calculateDuration(startTime, endTime)
            };
            
            timeEntries = [...timeEntries, entry];
            saveData();
        }

        function showDailyTargetWarning(currentHours, targetHours) {
            const warning = document.createElement('div');
            warning.className = 'warning';
            warning.innerHTML = `🎯 Daily target of ${targetHours}h reached! Current: ${currentHours.toFixed(1)}h`;
            document.body.appendChild(warning);
            
            setTimeout(() => {
                if (warning.parentNode) {
                    warning.parentNode.removeChild(warning);
                }
            }, 8000);
        }

        function showWarning() {
            const warning = document.createElement('div');
            warning.className = 'warning';
            warning.innerHTML = '⚠️ It\'s past 6:00 PM - Don\'t forget to stop your timer!';
            document.body.appendChild(warning);
            
            setTimeout(() => {
                if (warning.parentNode) {
                    warning.parentNode.removeChild(warning);
                }
            }, 10000);
        }

        function clearWarning() {
            const warnings = document.querySelectorAll('.warning');
            warnings.forEach(warning => {
                if (warning.parentNode) {
                    warning.parentNode.removeChild(warning);
                }
            });
        }

        function saveData() {
            try {
                if (typeof(Storage) === "undefined" || !localStorage) {
                    console.warn('localStorage not available');
                    return;
                }
                
                const dataToSave = {
                    employeeName: document.getElementById('employeeName').value,
                    dailyTarget: document.getElementById('dailyTarget').value,
                    timeEntries: timeEntries.map(entry => ({
                        id: entry.id,
                        date: entry.date,
                        category: entry.category,
                        project: entry.project,
                        startTime: entry.startTime,
                        endTime: entry.endTime,
                        duration: entry.duration
                    }))
                };
                
                localStorage.setItem('timeTrackerData', JSON.stringify(dataToSave));
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        function loadData() {
            try {
                if (typeof(Storage) === "undefined" || !localStorage) {
                    console.warn('localStorage not available');
                    return;
                }
                
                const data = localStorage.getItem('timeTrackerData');
                if (data) {
                    const parsed = JSON.parse(data);
                    document.getElementById('employeeName').value = parsed.employeeName || '';
                    document.getElementById('dailyTarget').value = parsed.dailyTarget || '8';
                    
                    timeEntries = (parsed.timeEntries || []).map(entry => ({
                        id: entry.id,
                        date: entry.date,
                        category: entry.category,
                        project: entry.project,
                        startTime: entry.startTime,
                        endTime: entry.endTime,
                        duration: parseFloat(entry.duration)
                    }));
                }
            } catch (error) {
                console.error('Error loading data:', error);
                timeEntries = [];
                document.getElementById('employeeName').value = '';
                document.getElementById('dailyTarget').value = '8';
            }
        }
    </script>
</body>
</html>